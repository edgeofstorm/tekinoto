{% extends "main/base.html" %}
{% load main_extras %}

{% block title %}
<h1 class="h2">Hesap Defteri - {{object.person}}</h1>
{% endblock title %}

{% block extract %}
<div class="btn-toolbar mb-2 mb-md-0">
    <div class="btn-group mr-2">
        <a href="{% url 'main:export_csv_person_ledger' pk=object.person.id %}" id="#printButton"
            class="btn btn-sm btn-outline-secondary"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                <path
                    d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                <path
                    d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
            </svg>&ensp;Dışa aktar&emsp;</a>
    </div>
</div>
{% endblock extract %}

{% block content %}
<div class="container">
    <!-- <div class="jumbotron jumbotron-fluid">
        <div class="container">
          <p class="lead">{{ object.fullname }}, toplam borç={{ object.ledger.total }}</p>
        </div>
      </div> -->
    <div class="alert alert-secondary" role="alert">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-6 col-md-4">
                    <p class="text-left h6">Toplam Borç = {{ total }} TL</p>
                </div>
                <div class="col-6 col-md-4">
                    <p class="text-left font-weight-bold h3">{{ object.person.fullname }}</p>
                </div>
                <div class="col-6 col-md-4">
                    <p class="text-right h6">Son İşlem Tarihi = {{ object.last_modified }}</p><br>
                    <p class="text-right h6">Telefon = {% if object.person.phone_number %}{{object.person.phone_number}}{% else %}-{% endif %}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-12 mx-auto">
            <table id="example" class="table table-striped table-bordered dt-responsive nowrap" style="width:100%">
                <thead>
                    <tr>
                        <th>Parça</th>
                        <th>Güncel Fiyatı</th>
                        <th>Satış Fiyatı</th>
                        <th>Adet</th>
                        <th>Toplam Fiyat</th>
                        <th>Ödenen Miktar</th>
                        <th>Kalan Borç</th>
                        <th>Sipariş Tarihi</th>
                        <th>Ödendi mi ?</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        
        $('#example').DataTable({
            "processing": true,
            "serverSide": true,
            ajax: "{% url 'main:order_list_json' pk=object.person.pk %}",
            columnDefs: [ { orderable: false, targets: [0,1,2,3,5,6] }],
            order: [[ 4, 'asc' ], [ 8, 'asc' ], [ 7, 'asc' ]],
            // "columnDefs": [
            //     { "searchable": false, "targets": 10}
            // ],
            // "columns": [
            //     { "data": "image", "sortable": false,"searchable":false },
            // ],
            // columnDefs: [
            // {
            //     name: 'name',
            //     orderable: false,
            //     searchable: false,
            //     targets: [0]
            // },
            // {
            //     name: 'price',
            //     orderable: false,
            //     searchable: false,
            //     targets: [1]
            //     },
            //     {
            //     name: 'sale_price',
            //     orderable: false,
            //     searchable: false,
            //     targets: [2]
            //     },
            //     {
            //     name: 'amount',
            //     orderable: false,
            //     searchable: false,
            //     targets: [3]
            //     },
            //     {
            //     name: 'total',
            //     orderable: true,
            //     searchable: true,
            //     targets: [4]
            //     },
            //     {
            //     name: 'paid_amount',
            //     orderable: true,
            //     searchable: true,
            //     targets: [5]
            //     },
            //     {
            //     name: 'remaining',
            //     orderable: false,
            //     searchable: false,
            //     targets: [6]
            //     },
            //     {
            //     name: 'timestamp',
            //     orderable: true,
            //     searchable: true,
            //     targets: [7]
            //     },
            //     {
            //     name: 'paid',
            //     orderable: false,
            //     searchable: false,
            //     targets: [8]
            //     },
            //     {
            //     name: 'image',
            //     orderable: false,
            //     searchable: false,
            //     targets: [9]
            //     },
            // ],
            language:
            {
                "decimal": "",
                "emptyTable": "Henüz bir kayıt oluşturulmamış",
                "info": "Sıralamak için tablo başlıklarına tıkla</br>Düzenlemek için parça ismine tıkla</br>_TOTAL_ kayıt arasından _START_ ile _END_ arasındaki kayıtlar gösteriliyor",
                "infoEmpty": "0 kayıt arasından 0 dan 0 kadar olanı gösteriliyor",
                "infoFiltered": "</br>(toplam _MAX_ kayıt arasından filtrelendi)",
                "infoPostFix": "",
                "thousands": ",",
                searchPlaceholder: "Parca ismi gir",
                "lengthMenu": "_MENU_ kayıt göster",
                "loadingRecords": "Yükleniyor...",
                "processing": "İşleniyor...",
                "search": "Ara:",
                "zeroRecords": "Aramanızla eşleşen öge bulunmamaktadır",
                "paginate": {
                    "first": "İlk",
                    "last": "Son",
                    "next": "İleri",
                    "previous": "Geri"
                },
                "aria": {
                    "sortAscending": ": artan şekilde sıralama",
                    "sortDescending": ": azalan şekilde sırala"
                }
            },
            // "columnDefs": [{
            //     "targets": 0,
            //     "render": function (data, type, row, meta) {
            //         return '<a href="{% url "main:homepage" %}">' + data + '</a>';
            //     }
            // }]
        });
        $('.dataTables_filter input[type="search"]').css(
            { 'width': '350px', 'display': 'inline-block' }
        );
        var $a = $('<div class="col-sm-12 col-md-4"><a href="{% url "main:order_item_create" pk=object.person.id %}" class="btn btn-success btn-sm">&emsp;<svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>&ensp;Hesaba yeni borç gir&emsp;</a></div>"');
        $('#example_wrapper').find('.row').eq(0).addClass('d-flex justify-content-between');
        $($('#example_wrapper').find('.row')[0].children[0]).attr('class', 'col-sm-12 col-md-4');
        $($('#example_wrapper').find('.row')[0].children[1]).attr('class', 'col-sm-12 col-md-4');
        $('#example_wrapper').find('.row').eq(0).children().first().after($a);
    </script>
</div>

{% endblock content %}